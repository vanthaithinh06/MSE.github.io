<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" type="image/x-icon" href="https://i.imgur.com/oYVfpYl.png" />
    <title>Sign in | Sign Up | MEC Lab</title>
    <link rel="stylesheet" href="style.css">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
        xintegrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />

    <!-- 1. THÊM THƯ VIỆN SUPABASE -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

</head>

<body>
    <li style="color: transparent"></li>
    <div class="container" id="container">
        <div class="form-container sign-up">
            <!-- 2. CẬP NHẬT SIGN UP FORM -->
            <form id="sign-up-form">
                <h1>Create Account</h1>
                <div class="social-icons">
                    <a href="https://www.facebook.com/" class="icon" style="background-color: #00b0fe; color: white;"><i
                            class='bx bxl-facebook'></i></a>
                    <a href="https://accounts.google.com/v3/signin/identifier?service=mail&continue=https%3A%2F%2Fmail.google.com%2Fmail%2F&flowName=GlifWebSignIn&flowEntry=AccountChooser&ec=asw-gmail-globalnav-signin&ddm=0"
                        class="icon" style="background-color: #ff2972; color: white;"><i class='bx bxl-google'></i></a>
                    <a href="https://www.linkedin.com/" class="icon" style="background-color: #01bdab; color: white;"><i
                            class='bx bxl-linkedin'></i></a>
                    <a href="https://github.com/" class="icon" style="background-color: #a529ff; color: white;"><i
                            class='bx bxl-github'></i></a>
                </div>
                <samp style="font-weight: 700;">or use your email for registration</samp>
                <input type="text" id="signup-name" placeholder="Name">
                <input type="email" id="signup-email" placeholder="Email" required>
                <input type="password" id="signup-password" placeholder="Password" required>
                <button type="submit">Sign Up</button> <!-- Bỏ thẻ <a> -->
            </form>
        </div>
        <div class="form-container sign-in">
            <!-- 3. CẬP NHẬT SIGN IN FORM -->
            <form id="sign-in-form">
                <h1>Sign In</h1>
                <div class="social-icons">
                    <a href="https://www.facebook.com/" class="icon" style="background-color: #00b0fe; color: white;"><i
                            class='bx bxl-facebook'></i></a>
                    <a href="https://accounts.google.com/v3/signin/identifier?service=mail&continue=https%3A%2F%2Fmail.google.com%2Fmail%2F&flowName=GlifWebSignIn&flowEntry=AccountChooser&ec=asw-gmail-globalnav-signin&ddm=0"
                        class="icon" style="background-color: #ff2972; color: white;"><i class='bx bxl-google'></i></a>
                    <a href="https://www.linkedin.com/" class="icon" style="background-color: #01bdab; color: white;"><i
                            class='bx bxl-linkedin'></i></a>
                    <a href="https://github.com/" class="icon" style="background-color: #a529ff; color: white;"><i
                            class='bx bxl-github'></i></a>
                </div>
                <samp style="font-weight: 700;">Hoặc sử dụng email password</samp>
                <input type="email" id="signin-email" placeholder="Email" required>
                <input type="password" id="signin-password" placeholder="Password" required>
                <h2><a href="#" class="fp">Quên mật khẩu?</a></h2>
                <button type="submit" id="signin-submit-btn">Sign In</button> <!-- Bỏ thẻ <a> và thêm ID -->

                <!-- 4. THÊM VÙNG HIỂN THỊ LỖI -->
                <p id="auth-message" style="color: #ff2972; margin-top: 10px; font-weight: 700; height: 20px;"></p>
            </form>
        </div>
        <div class="form-container forgot-password" style="display: none;">
            <!-- 5. CẬP NHẬT FORGOT PASSWORD FORM -->
            <form id="forgot-password-form">
                <h1>Forgot Password</h1>
                <samp>Nhập email của bạn để có thể khôi phục mật khẩu </samp>
                <input type="email" id="forgot-email" placeholder="Email" required>
                <button type="submit">Gửi</button>
            </form>
        </div>
        <div class="toggle-container">
            <div class="toggle">
                <div class="toggle-panel toggle-left">
                    <h1>Welcome Back!</h1>
                    <p style="color: black;">Enter your personal details to use all of site features</p>
                    <button class="hidden" id="login">Sign In</button>
                </div>
                <div class="toggle-panel toggle-right">
                    <h1>Xin chào quý khách</h1>
                    <p style="color: black;">Quý khách vui lòng đăng ký thông tin để có thể sử dụng tất cả các dịch vụ
                        của cửa hàng </p>
                    <button class="hidden" id="register">Sign Up</button>
                </div>
            </div>
        </div>
    </div>

    <section class="form__animation">
        <div id="ball">
            <div class="ball">
                <div id="face">
                    <div class="ball__eyes">
                        <div class="eye_wrap"><span class="eye"></span></div>
                        <div class="eye_wrap"><span class="eye"></span></div>
                    </div>
                    <div class="ball__mouth"></div>
                </div>
            </div>
        </div>
        <div class="ball__shadow"></div>
    </section>

    <div class="stage" data-js="stage"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r73/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/1.18.0/TweenMax.min.js"></script>
    <script src="https://app.embed.im/snow.js"></script>
    <script src="script.js"></script>

    <!-- 6. THÊM SCRIPT LOGIC SUPABASE -->
    <script type="module">
        // Lấy hàm createClient từ thư viện Supabase đã import ở <head>
        const { createClient } = supabase;

        // --- CẤU HÌNH SUPABASE ---
        const SUPABASE_URL = 'https://kusupazutodidrwqnmrz.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt1c3VwYXp1dG9kaWRyd3FubXJ6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA2NjUxNTMsImV4cCI6MjA3NjI0MTE1M30.7sNXeknTqj6ahtb9vrJhtGYWCw-M0UGLuxSxLVvzaI4';
        // ---------------------------------

        // Khởi tạo Supabase client
        const _supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // Lấy các form và thông báo
        const signInForm = document.getElementById('sign-in-form');
        const signUpForm = document.getElementById('sign-up-form');
        const forgotPasswordForm = document.getElementById('forgot-password-form');
        const authMessage = document.getElementById('auth-message');

        // 1. Xử lý Đăng nhập (Sign In)
        if (signInForm) {
            signInForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const email = document.getElementById('signin-email').value;
                const password = document.getElementById('signin-password').value;
                if (authMessage) authMessage.textContent = 'Đang đăng nhập...';

                const { data, error } = await _supabase.auth.signInWithPassword({
                    email: email,
                    password: password,
                });

                if (error) {
                    if (authMessage) authMessage.textContent = `Lỗi: ${error.message}`;
                } else if (data.user) {
                    if (authMessage) authMessage.textContent = 'Đăng nhập thành công! Đang chuyển hướng...';
                    // CHUYỂN HƯỚNG ĐẾN TRANG Meishut
                
                    window.location.href = 'meishut.html';
                }
            });
        }

        // 2. Xử lý Đăng ký (Sign Up)
        if (signUpForm) {
            signUpForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const email = document.getElementById('signup-email').value;
                const password = document.getElementById('signup-password').value;
                if (authMessage) authMessage.textContent = 'Đang đăng ký...';

                const { data, error } = await _supabase.auth.signUp({
                    email: email,
                    password: password,
                });

                if (error) {
                    if (authMessage) authMessage.textContent = `Lỗi: ${error.message}`;
                } else if (data.user) {
                    // Mặc định Supabase cần xác nhận email
                    if (authMessage) authMessage.textContent = 'Đăng ký thành công! Vui lòng kiểm tra email để xác nhận.';
                }
            });
        }

        // 3. Xử lý Quên mật khẩu (Forgot Password)
        // Ghi đè logic cũ trong script.js
        if (forgotPasswordForm) {
            forgotPasswordForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const email = document.getElementById('forgot-email').value;

                // Hiển thị thông báo ở form chính
                const mainAuthMsg = document.getElementById('auth-message');
                if (mainAuthMsg) mainAuthMsg.textContent = 'Đang gửi email khôi phục...';

                const { data, error } = await _supabase.auth.resetPasswordForEmail(email, {
                    redirectTo: window.location.href, // Link để quay lại sau khi reset
                });

                if (error) {
                    if (mainAuthMsg) mainAuthMsg.textContent = `Lỗi: ${error.message}`;
                } else {
                    if (mainAuthMsg) mainAuthMsg.textContent = 'Đã gửi email khôi phục! Vui lòng kiểm tra hòm thư.';
                }

                // Ẩn form quên mật khẩu và hiện lại form đăng nhập
                document.querySelector('.form-container.forgot-password').style.display = 'none';
                document.querySelector('.form-container.sign-in').style.display = 'block';

            });
        }
    </script>
</body>

</html>